@default:
    just --list

update:
    #!/usr/bin/env bash
    if [ $(command -v chezmoi) ]; then
        chezmoi update
    fi

{{- if ne .chezmoi.os "windows" }}
    nix flake update --flake {{ .chezmoi.homeDir }}/.config/home-manager
    home-manager switch
{{- end }}

clean:
    #!/usr/bin/env bash
    home-manager expire-generations "-7 days"

{{- if eq .chezmoi.hostname "pwnyboy" }}

compose-update:
    #!/usr/bin/env bash
    for config in `docker compose ls | awk 'NR>1 {print $3}'`; do
        printf "=====[ %s ]======" $( basename $(dirname $config) | sed 's/.*/\u&/' )
        docker compose -f $config build
        docker compose -f $config pull
        docker compose -f $config up -d
    done

compose-clean:
    docker image prune -f
{{- else }}

pwnyup:
    tailscale ping -c 0 pwnyboy
{{- end }}
